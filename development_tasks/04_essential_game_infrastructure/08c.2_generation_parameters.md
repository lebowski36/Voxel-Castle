# Generation Parameters System
*Created: 2025-06-05 22:59*
*Last Updated: 2025-06-05 23:30*

## Overview
This document outlines the parameter system for Voxel Castle's two-tier world generation. The parameter system provides scalable configuration from small worlds to massive quarter-Earth-size worlds, with adaptive parameter scaling based on world size.

## Design Goals

1. **Two-Tier Configurability**: Separate parameters for world creation vs. runtime generation
2. **Scalable Worlds**: Parameters that adapt to world sizes from 10km² to 25,000,000km²
3. **Performance Awareness**: Parameters that consider generation time vs. quality trade-offs
4. **Presets**: Ready-to-use parameter sets for different world types and sizes
5. **Extensibility**: Easy addition of new parameters for future features
6. **Historical Integration**: Parameters for configurable historical simulation
7. **UI Integration**: Connect parameters to world creation dialog

## Core Components

### WorldParameters Class

**Purpose**: Central storage for all generation parameters with size-aware scaling

**Key Functionality**:
- [ ] Store and manage parameters for both tiers
- [ ] Provide size-appropriate default values
- [ ] Support parameter presets for different world scales
- [ ] Serialize/deserialize parameters to/from save files
- [ ] Parameter validation and range checking
- [ ] Automatic parameter scaling based on world size

### Scale-Aware Parameter Categories

#### World Scale Parameters
- [ ] **World Size**: Physical dimensions (10km² to 25,000,000km²)
- [ ] **Region Resolution**: Size of world template regions (typically 1km²)
- [ ] **Chunk Size**: Runtime voxel chunk dimensions (32x32x32)
- [ ] **Detail Level**: Balance between world template detail and generation speed
- [ ] **Historical Simulation Depth**: Configurable complexity for different world sizes

#### Historical Simulation Parameters
- [ ] **Simulation Duration**: Years of simulated history (100 to 25,000+ years)
- [ ] **Simulation Detail**: None, Basic, Standard, Detailed, Epic
- [ ] **Parallel Regions**: Enable parallel processing for large worlds
- [ ] **Overarching Events**: Cross-regional events (climate changes, migrations)
- [ ] **Civilization Complexity**: Simple tribes to complex empires
- [ ] **Event Frequency**: Rate of historical events and conflicts

#### Tier 1: World Template Parameters
- [ ] **Continental Structure**: Major landmass placement and sizes  
- [ ] **Climate Zones**: Temperature and precipitation gradients
- [ ] **Biome Distribution**: Large-scale biome placement patterns
- [ ] **Major Resource Deposits**: Regional-scale ore and resource distribution
- [ ] **Civilization Sites**: City and settlement placement
- [ ] **Geographic Features**: Mountain ranges, river systems, coastlines

#### Tier 2: Runtime Chunk Parameters
- [ ] **Terrain Detail**: Noise octaves and local height variation
- [ ] **Biome Implementation**: How regional biomes appear at voxel level
- [ ] **Structure Placement**: Buildings, ruins, and landmarks within chunks
- [ ] **Resource Veins**: Detailed ore placement within regional constraints
- [ ] **Cave Networks**: Underground system generation
- [ ] **Vegetation Density**: Tree and plant placement patterns

#### Cave Parameters
- [ ] Cave frequency
- [ ] Cave size distribution
- [ ] Tunnel width/height range
- [ ] Cavern frequency/size

#### Resource Parameters
- [ ] Ore frequencies (by type)
- [ ] Ore vein size distribution
- [ ] Ore vertical distribution
- [ ] Special resource frequency

### World Type Presets

**Purpose**: Pre-configured parameter sets for different world types

**Preset Types**:
- [ ] **Normal**: Balanced terrain with moderate variation
- [ ] **Flat**: Minimal height variation, good for building
- [ ] **Amplified**: Exaggerated terrain features, high mountains
- [ ] **Islands**: Archipelago-style terrain with water between landmasses
- [ ] **Custom**: User-defined parameter set

## Implementation Details

### Parameter Storage

Parameters will be stored in a hierarchical structure:

```
WorldParameters
├── TerrainParameters
│   ├── baseHeight
│   ├── heightVariation
│   └── ...
├── BiomeParameters
│   ├── biomeScale
│   ├── temperatureScale
│   └── ...
└── ...
```

### Preset Definition

Presets will define parameter values for different world types:

```
// Pseudocode (not actual implementation)
void createNormalPreset(WorldParameters& params) {
    params.terrain.baseHeight = 64;
    params.terrain.heightVariation = 24;
    params.terrain.noiseScale = 0.01;
    // Set other parameters...
}
```

### Parameter Serialization

Parameters will be serialized to JSON for storage in level.dat:

```json
{
  "worldParameters": {
    "terrain": {
      "baseHeight": 64,
      "heightVariation": 24,
      "noiseScale": 0.01
    },
    "biomes": {
      "biomeScale": 0.02,
      "temperatureScale": 0.001
    }
  }
}
```

## User Interface Integration

The parameter system will connect to the UI through:

1. **World Type Selection**: Choosing a preset in the Create New World dialog
2. **Advanced Parameters**: Optional UI for fine-tuning individual parameters
3. **Custom Presets**: Ability to save/load custom parameter sets

## Transition Strategy

### Phase 1: Core Parameter System
- [ ] Define basic parameter structure
- [ ] Implement WorldParameters class
- [ ] Create standard presets (Normal, Flat, Amplified)
- [ ] Connect parameters to terrain generation

### Phase 2: Extended Parameters
- [ ] Add biome parameters
- [ ] Add structure parameters
- [ ] Add cave/resource parameters
- [ ] Implement parameter validation

### Phase 3: UI & Persistence
- [ ] Connect parameters to world creation UI
- [ ] Implement parameter serialization
- [ ] Add parameter loading from level.dat
- [ ] Create advanced parameter editor (optional)

## Technical Notes

### Parameter Range Validation

To ensure world generation remains stable:
- Define valid ranges for each parameter
- Clamp values that exceed these ranges
- Provide warnings for extreme values

### Parameter Dependencies

Some parameters may affect others:
- Implement dependency tracking
- Automatically adjust dependent parameters
- Prevent invalid parameter combinations

### Performance Impact

Monitor how different parameters affect generation performance:
- Document which parameters most impact performance
- Provide performance hints in advanced UI
- Create "Low Performance Impact" presets for slower systems

## Testing Strategy

1. **Preset Testing**: Verify each preset creates appropriate terrain
2. **Extreme Value Testing**: Test with min/max parameter values
3. **Serialization Testing**: Ensure parameters save and load correctly
4. **UI Testing**: Verify UI controls properly affect generation

## Testability & Visual Feedback

### Real-Time Parameter Adjustment UI

To enable immediate feedback when adjusting parameters, we'll implement:

#### Parameter Editor Panel
- [ ] **Live Parameter Sliders**: In-game UI with sliders for each generation parameter
- [ ] **Real-Time Preview**: Mini-world preview that updates as parameters change
- [ ] **Parameter Value Display**: Show exact numeric values alongside sliders
- [ ] **Reset to Default**: Quick buttons to reset individual parameters or entire categories
- [ ] **Preset Selector**: Dropdown to switch between predefined parameter sets

#### Immediate Visual Feedback
- [ ] **Chunk Regeneration**: Button to regenerate current chunk with new parameters
- [ ] **Parameter Effect Highlighting**: Visual overlays showing which areas are affected by specific parameters
- [ ] **Before/After Comparison**: Split-screen view showing parameter changes side-by-side
- [ ] **Parameter Impact Visualization**: Color-coded overlays showing how each parameter influences terrain

### Development Testing Tools

#### Parameter Testing Workflow
- [ ] **Parameter Sweep Tool**: Generate multiple small worlds with parameter variations
- [ ] **A/B Testing Interface**: Quick comparison between two parameter sets
- [ ] **Parameter Sensitivity Analysis**: Visualize how sensitive terrain is to small parameter changes
- [ ] **Validation Indicators**: Visual cues showing when parameters are outside recommended ranges

#### Debug Visualization
- [ ] **Noise Layer Visualization**: Toggle individual noise layers on/off to see their contributions
- [ ] **Parameter Heat Maps**: Show parameter influence across the world as colored overlays
- [ ] **Generation Step Breakdown**: Step-by-step visualization of how parameters affect generation stages
- [ ] **Statistical Display**: Real-time display of terrain statistics (average height, variation, etc.)

### Integration Testing

#### UI Integration Testing
- [ ] **Parameter Persistence Test**: Verify parameters save/load correctly with worlds
- [ ] **UI Responsiveness Test**: Ensure parameter changes update preview without lag
- [ ] **Cross-Platform UI Test**: Verify parameter editor works on different screen sizes
- [ ] **Parameter Validation Test**: Test UI behavior with invalid parameter values

#### World Generation Testing
- [ ] **Parameter Effect Verification**: Visual tests to confirm parameters work as documented
- [ ] **Edge Case Testing**: Test extreme parameter values and their visual results
- [ ] **Performance Impact Testing**: Monitor generation speed with different parameter combinations
- [ ] **Consistency Testing**: Verify same parameters produce same results across sessions

### Implementation Phases with Testing

#### Phase 1: Basic Parameter Infrastructure + Testing UI
- [ ] Implement WorldParameters class with basic functionality
- [ ] Create simple parameter editor UI with sliders
- [ ] Add real-time parameter value display
- [ ] Implement chunk regeneration with new parameters
- [ ] **Test**: Verify parameter changes are immediately visible in regenerated chunks

#### Phase 2: Advanced UI Controls + Visual Feedback
- [ ] Add parameter presets and preset selector
- [ ] Implement before/after comparison view
- [ ] Add parameter effect highlighting overlays
- [ ] Create parameter impact visualization
- [ ] **Test**: Verify all UI controls provide immediate, clear visual feedback

#### Phase 3: Developer Tools + Advanced Testing
- [ ] Implement parameter sweep and A/B testing tools
- [ ] Add noise layer visualization toggles
- [ ] Create parameter heat maps and statistical displays
- [ ] Add parameter sensitivity analysis tools
- [ ] **Test**: Verify all developer tools provide actionable insights about parameter effects

## Next Steps

1. Implement basic WorldParameters class with immediate UI feedback capability
2. Create parameter editor UI with real-time preview
3. Test parameter changes with visual chunk regeneration
4. Expand to include all parameter categories with individual testing tools
5. Integrate with world creation dialog and save system
